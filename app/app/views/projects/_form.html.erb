<div class="container">
  <%= form_for(@project, :html => { :class=> "form-horizontal" }) do |f| %>

    <div class="form-group">
      <%= f.text_field :name, :class => "form-control", :placeholder => "Nom du projet" %>
    </div>

    <div class="form-group">
        <%= f.number_field :spices, :class => "form-control", :placeholder => "épices demandés" %>
    </div>

    <div class="form-group">
        <h2 class="text-center">Description et porteur(s) du projet:</h2>
        <%= f.cktext_area :description, class: 'someclass', ckeditor: { language: 'fr'} %>
    </div>

    <% @project.objectives.each_with_index do |objective, index| %>
      <%= f.fields_for :objectives, objective do |fq| %>
        <%= render 'objective_fields', :f => fq, :objective => objective, :index => index %>
      <% end %>
    <% end %>

    <div class="form-group">
      <div class="span7 text-center">
        <button type="submit" class="btn btn-default">Valider</button>
      </div>
    </div>
  <% end %>

</div>

<script>
  var picturesPush = {};

  // Put photo get on epitech intranet in ckeditor.
  function putPicture(editor, name){
    var image_tag='<img src="https://cdn.local.epitech.eu/userprofil/commentview/' + name + '.jpg" alt="' + name + '">';

    editor.insertHtml(image_tag);
  }

  // Listener on ckeditor, if email is recognise add picture
  var editorDescription = CKEDITOR.instances["project_description"];
  editorDescription.on('change', function() {
      var str = editorDescription.getData();
      var regex = /[a-z]+\.[a-z]+@epitech.eu\b/g;
      var match = str.match(regex);

      for (var i = 0; i < match.length; i++)
      {
        if (undefined == picturesPush[match[i]])
        {
          picturesPush[match[i]] = 1;
          putPicture(editorDescription, match[i].replace("@epitech.eu", ""));
        }
      }
  });
</script>